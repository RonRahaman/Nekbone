#!/usr/bin/env bash

set -e

REQ_WALLTIME="00:10:00"

  rm -rf *cobalt*
  REAFILE=$1
  CORECOUNT=$2

SESSION=${REAFILE%.[rR][eE][aA]}
echo "*** running session $SESSION"

echo $1        >  SESSION.NAME
echo `pwd`'/' >>  SESSION.NAME

  rm -f $SESSION.output
  rm -f logfile
  rm -f xxt_map.rea

OUTFILE="`pwd`/$SESSION.np=$CORECOUNT-jlse-mpi-`date "+%F_%H_%M_%S"`"
  touch $SESSION.rea
  touch $OUTFILE.output
  ln $OUTFILE.output $SESSION.output
  ln $OUTFILE.output logfile

echo "qsub  -q "gpu_mules" -n $CORECOUNT -t $REQ_WALLTIME -o logfile  ./nekbone "
COBALTJOB=`qsub -q "gpu_mules" -n $CORECOUNT -t $REQ_WALLTIME -o logfile  ./nekbone`
echo "=== cobalt job $COBALTJOB submitted to JLSE/Neddy"


